# 🔧 여러 명 수신자 및 HTML 메일 수정 완료

## ✅ 수정된 파일들

### 1. **mailer.py** - 핵심 수정
   - ❌ **문제**: 여러 수신자 전송 실패 (마지막 수신자만 전송됨)
   - ✅ **해결**: `send_data`를 dict → list of tuples로 변경하여 'to' 파라미터 반복 전송
   - ➕ **추가**: 내일 날짜 자동 계산 및 {DATE} 치환 기능

### 2. **processor.py** - 셀 주소 수정
   - 시트2 셀 읽기 위치 수정 (B1, B2, B3, B4 및 D1부터 수신자)

### 3. **메일설정_예시.txt** - 사용 가이드
   - 분류표.xlsx 시트2 설정 방법 상세 안내
   - HTML 이메일 작성 예시 제공

---

## 📊 HAR 로그 분석 결과

### 🔍 핵심 발견사항

#### 1️⃣ **Multiple Recipients 처리 방식**
```http
POST /mail/json/send.do
Content-Type: application/x-www-form-urlencoded

to=%22김준성...%22<jaajung@kepco.co.kr>
&to=%22이민규...%22<minkyu_lee@kepco.co.kr>
```

**기존 코드 (❌ 잘못됨)**:
```python
send_data = {}
for recipient in mail_config['recipients']:
    send_data['to'] = recipient  # 덮어쓰기! 마지막 수신자만 남음
```

**수정된 코드 (✅ 올바름)**:
```python
send_data = [
    ('fromaddr', mail_config['from_email']),
    ('subject', subject),
    # ... 다른 파라미터들
]

# 각 수신자를 별도 파라미터로 추가
for recipient in mail_config['recipients']:
    send_data.append(('to', recipient))  # 누적 추가!
```

#### 2️⃣ **HTML 이메일 포맷**
HAR 로그에서 발견된 실제 HTML 구조:
```html
<p><span style="color: rgb(255, 0, 0);"><strong>빨간색 굵은 글씨</strong></span></p>
<p><span style="color: rgb(0, 0, 255);"><strong>파란색 굵은 글씨</strong></span></p>
```

#### 3️⃣ **날짜 형식**
- 제목: `251119` (YYMMDD)
- 본문: `'25-11-19` (YY-MM-DD, 앞에 작은따옴표)

---

## 📝 분류표.xlsx 시트2 설정 방법

### 시트 구조
```
┌────────────┬─────────────────────────────────────────┬────┬──────────────────────┐
│     A      │              B                          │ C  │          D           │
├────────────┼─────────────────────────────────────────┼────┼──────────────────────┤
│ from_name  │ 강원본부 전자제어부                      │    │ user1@kepco.co.kr    │
├────────────┼─────────────────────────────────────────┼────┼──────────────────────┤
│ from_email │ gwpower@kepco.co.kr                     │    │ user2@kepco.co.kr    │
├────────────┼─────────────────────────────────────────┼────┼──────────────────────┤
│ subject    │ [안전] {DATE} 공사현장 점검 리스트 송부  │    │ user3@kepco.co.kr    │
├────────────┼─────────────────────────────────────────┼────┼──────────────────────┤
│ body       │ (HTML 내용)                             │    │                      │
└────────────┴─────────────────────────────────────────┴────┴──────────────────────┘
```

### 주요 포인트

1. **A열**: 설정 항목 이름 (고정, 수정 불필요)
2. **B열**: 실제 설정값 (여기만 수정)
3. **D열**: 수신자 이메일 (D1부터 아래로 계속, 빈 셀까지)

### 날짜 자동 치환

제목이나 본문에 `{DATE}` 입력 시:
- **제목**: 251120 (YYMMDD)
- **본문**: '25-11-20 (YY-MM-DD)

**예시**:
```
B3 (subject): [안전] {DATE} 공사현장 안전점검 우선순위 리스트 송부
→ 실제 발송: [안전] 251120 공사현장 안전점검 우선순위 리스트 송부

B4 (body): {DATE} 공사현장 점검...
→ 실제 발송: '25-11-20 공사현장 점검...
```

---

## 🎨 HTML 이메일 작성 가이드

### B4 셀에 입력할 HTML 예시

```html
<div class="sensEdContentAreaCls" data-id="sensEdContentArea" style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); line-height: 150%; font-family: 돋움 !important; font-size: 12pt;">
<div class="sensEdContentAreaCls" data-id="sensEdContentArea" style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); line-height: 150%; font-family: 돋움 !important; font-size: 12pt;">
<p>안녕하십니까, 안전재난부에서 안내드립니다.</p>
<div data-id="sensEdContentArea" style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); line-height: 150%; font-family: 돋움 !important; font-size: 12pt;">
<p>{DATE} 공사현장 점검 우선순위 리스트를 붙임과 같이&nbsp;송부드립니다.</p>
<p><span style="color: rgb(255, 0, 0);"><strong>※ 우선순위에 추가하고싶으신 내용이 있으시다면 언제든지 연락 주시기 바랍니다.</strong></span></p>
<p>&nbsp;</p>
<p>특별안전관리 100일 무재해 운동 추진계획의 일환으로</p>
<p><span style="color: rgb(0, 0, 255);"><strong>일일 필수입회 공사 안전점검 실적관리 및 우수사업소 포상을 진행하게 됐습니다.</strong></span></p>
<p>강원본(안전)-11467('25.10.15) - 본부 일일 필수입회 공사 안전점검 우수 사업소 포상 계획 알림**</p>
<p>&nbsp;</p>
<p><span style="color: rgb(0, 0, 0);">감사합니다.</span></p>
</div>
</div>
</div>
```

### HTML 스타일 적용법

| 효과 | HTML 코드 |
|------|-----------|
| **빨간색 굵은 글씨** | `<span style="color: rgb(255, 0, 0);"><strong>텍스트</strong></span>` |
| **파란색 굵은 글씨** | `<span style="color: rgb(0, 0, 255);"><strong>텍스트</strong></span>` |
| **검은색 일반 글씨** | `<span style="color: rgb(0, 0, 0);">텍스트</span>` |
| **줄바꿈** | `<p>텍스트</p>` |
| **공백 줄** | `<p>&nbsp;</p>` |

---

## 🚀 테스트 방법

### 1. 분류표.xlsx 시트2 설정

```
A1: from_name    B1: 강원본부 전자제어부        D1: jaajung@kepco.co.kr
A2: from_email   B2: gwpower@kepco.co.kr       D2: minkyu_lee@kepco.co.kr
A3: subject      B3: [안전] {DATE} 공사현장 안전점검 우선순위 리스트 송부
A4: body         B4: (위 HTML 전체 복사)
```

### 2. 프로그램 실행

```bash
python main.py
```

### 3. 확인사항

- ✅ 2명 이상의 수신자에게 모두 메일 전송되는지
- ✅ 제목에 내일 날짜가 YYMMDD 형식으로 들어가는지
- ✅ 본문에 내일 날짜가 'YY-MM-DD 형식으로 들어가는지
- ✅ 빨간색, 파란색 텍스트가 제대로 표시되는지
- ✅ 굵은 글씨가 제대로 표시되는지

---

## 🔧 주요 변경사항 상세

### mailer.py 변경점

#### 1. Import 추가
```python
from datetime import datetime, timedelta  # timedelta 추가
```

#### 2. 내일 날짜 계산
```python
tomorrow = datetime.now() + timedelta(days=1)
date_yymmdd = tomorrow.strftime('%y%m%d')       # 251120
date_yy_mm_dd = tomorrow.strftime("'%y-%m-%d")  # '25-11-20
```

#### 3. 날짜 치환
```python
subject = mail_config['subject'].replace('{DATE}', date_yymmdd)
body_text = mail_config['body'].replace('{DATE}', date_yy_mm_dd)
```

#### 4. 다중 수신자 처리 (핵심!)
```python
# ❌ 기존 방식 (dict)
send_data = {
    'to': recipient  # 마지막 값으로 덮어씀
}

# ✅ 새로운 방식 (list of tuples)
send_data = [
    ('fromaddr', mail_config['from_email']),
    ('subject', subject),
    # ...
]

# 각 수신자를 별도로 추가
for recipient in mail_config['recipients']:
    send_data.append(('to', recipient))  # 누적!
```

### processor.py 변경점

```python
# 기존 (잘못됨)
from_name = ws2.cell(row=2, column=1).value    # A2
from_email = ws2.cell(row=2, column=2).value   # B2
recipients: D2~DN
subject = ws2.cell(row=2, column=5).value      # E2
body = ws2.cell(row=2, column=6).value         # F2

# 수정 (올바름)
from_name = ws2.cell(row=1, column=2).value    # B1
from_email = ws2.cell(row=2, column=2).value   # B2
recipients: D1~DN
subject = ws2.cell(row=3, column=2).value      # B3
body = ws2.cell(row=4, column=2).value         # B4
```

---

## 💡 FAQ

### Q1: 수신자를 몇 명까지 추가할 수 있나요?
**A**: D열에 빈 셀이 나올 때까지 무제한 추가 가능합니다. D1, D2, D3... 계속 추가하세요.

### Q2: HTML을 잘 모르는데 어떻게 작성하나요?
**A**: `메일설정_예시.txt` 파일의 HTML 예시를 복사해서 B4 셀에 붙여넣고, 필요한 부분만 수정하세요.

### Q3: 날짜를 직접 입력하고 싶어요
**A**: `{DATE}` 대신 직접 날짜를 입력하면 됩니다.
   - 제목: `[안전] 251120 공사현장...`
   - 본문: `'25-11-20 공사현장...`

### Q4: 색깔을 다른 색으로 바꾸고 싶어요
**A**: `rgb(255, 0, 0)` 부분을 변경하세요
   - 빨강: rgb(255, 0, 0)
   - 파랑: rgb(0, 0, 255)
   - 녹색: rgb(0, 255, 0)
   - 검정: rgb(0, 0, 0)

---

## ✨ 완료!

이제 여러 명에게 HTML 형식의 아름다운 메일을 보낼 수 있습니다! 🎉
